# О проекте

Цель проекта - автоматическая генерация полигональных сеток представительных объемов заданной структуры с гибкой настройкой параметров. Для интеграции с расчетными системами на основе метода конечных элементов модуль генерации сеток выделен в микросервис

`localhost:8080/docs` - API-документация HTTP-сервиса для генерации сеток

generation_usage_example.py - скрипт чтобы строить модельки напрямую, минуя http-сервис. Для тестовых целей

# Установка зависимостей

```bash
pip install -r requirements.txt
```

Для запуска через Procfile:

```bash
gem install foreman
```

Также для работы celery нужен Redis. Устанавливать по [гайду из документации Redis](https://redis.io/docs/latest/operate/oss_and_stack/install/install-redis/)

# Запуск проекта

В проекте используется аутентификация по токену в хедере API-KEY, поэтому для тестов необходимо добавлять этот токен во все запросы.
Корректное значение задается переменной окружения API_KEY, поэтому её необходимо устанавливать перед запуском сервера

## Запуск через Docker

Можно просто запустить docker-compose со стандартными настройками. Корректный API-KEY в этом случае `123` (поменять для production !)
```bash
docker-compose up
```

При необходимости проверить webhook, можно отдельно запустить test_webhook сервер(тут процесс через Docker не налажен пока):

```bash
python -m uvicorn test_webhook:app --reload --port=8001
```

Тогда в запросе `/generate` нужно будет указывать webhook_url: http://localhost:8001/webhook

## Запуск без Docker

### Запуск через foreman

Если установлен `foreman`, можно запускать все сервисы через

```bash
API_KEY=<ваш ключ> foreman start
```

### Запуск команд вручную
Альтернативно, можно запускать их по одному:

1. Запуск основного сервера

```bash
API_KEY=<ваш ключ> python -m uvicorn main:app --reload
```

2. Запуск celery

```bash
celery -A tasks.celery_app worker --loglevel=info
```

3. (Опционально) запуск сервера для тестового веб-хука на порту 8001

```bash
python -m uvicorn test_webhook:app --reload --port=8001
```

